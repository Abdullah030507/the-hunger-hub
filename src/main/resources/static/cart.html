<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Your Cart - The Hunger Hub</title>
  <link rel="stylesheet" href="css/style.css" />
  <link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
/>
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="logo">The Hunger Hub</div>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="menu.html">Menu</a></li>
        <li><a href="customize.html">Customize</a></li>
        <li>
          <a href="cart.html" class="cart-icon">
            üõí <span id="cart-count">0</span>
          </a>
        </li>
        <li>
		  <button id="logout-btn" title="Logout" class="logout-icon">
		    <i class="fa-solid fa-power-off"></i>
		  </button>
		</li>
      </ul>
    </nav>
  </header>

  <main>
    <section class="cart-section">
      <h2>Your Cart</h2>
      <ul id="cart-items" class="cart-list"></ul>
      <p class="total-display"><strong>Total: ‚Çπ<span id="total">0</span></strong></p>
      <button class="checkout-btn" onclick="checkout()">Checkout</button>
    </section>
  </main>
  
  <script src="js/script.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
  (async () => {
    const res = await fetch("/api/supabase-config");
    const config = await res.json();
    const supabase = window.supabase.createClient(config.url, config.key);
    const { data: { user } } = await supabase.auth.getUser();

    if (!user) {
      window.location.href = "login.html";
    }
  })();
</script>
<script>
  document.addEventListener("DOMContentLoaded", async () => {
    // Fetch Supabase config
    const res = await fetch("/api/supabase-config");
    const config = await res.json();
    const supabase = window.supabase.createClient(config.url, config.key);

    // Logout button logic
    const logoutBtn = document.getElementById("logout-btn");
    if (logoutBtn) {
      logoutBtn.addEventListener("click", async () => {
        try {
          await supabase.auth.signOut(); // ‚Üê Supabase logout
          localStorage.removeItem("user_id");
          localStorage.removeItem("cart");
          window.location.href = "login.html"; // redirect to login or combined page
        } catch (error) {
          console.error("Logout failed:", error.message);
          alert("Something went wrong during logout.");
        }
      });
    }
  });
</script>

</body>
</html>
